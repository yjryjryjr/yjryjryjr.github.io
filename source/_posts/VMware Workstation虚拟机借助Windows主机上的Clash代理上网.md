---
title: VMware Workstation虚拟机借助Windows主机上的Clash代理上网
date: 2023-01-12 17:31
tags:
---

### 前言

机器环境如下：

> 主机：Win11
>
> 虚拟机：VMware Workstation上的Ubuntu20.04
>
> 软件：Clash v0.20.9（代理配置默认完成）

虚拟机网络连接是NAT，再对Clash和Ubuntu简单的配置即可，无需修改主机配置

### 步骤

1. 虚拟机选择NAT网络连接模式

![image](https://img2023.cnblogs.com/blog/2717155/202301/2717155-20230112172824703-1457572184.png)


2. 配置Clash

![image](https://img2023.cnblogs.com/blog/2717155/202301/2717155-20230112172841981-1721671338.png)


   记住端口号（后面会用到），这是Clash代理各种网络协议占用的端口。Allow LAN打开，个人理解这是允许局域网内的其他机器连接Clash。

3. 配置Ubuntu

   先获取主机IP（选择自己正在使用的以太网），在cmd窗口输入ifconfig

   我这里用的是第一个

   ![image](https://img2023.cnblogs.com/blog/2717155/202301/2717155-20230112172854214-2126672083.png)


   在Ubuntu网络设置点击协议设置

   ![image](https://img2023.cnblogs.com/blog/2717155/202301/2717155-20230112172901602-66648079.png)


   配置第一列填主机IP，第二列填之前Clash的端口

   ![image](https://img2023.cnblogs.com/blog/2717155/202301/2717155-20230112172916077-1009725956.png)


   不出意外Gxxgle和gitxxb可以在虚拟机正常访问了。

   ![image](https://img2023.cnblogs.com/blog/2717155/202301/2717155-20230112172922356-1770636923.png)


### 总结

与网络中的教程不同，有的设置桥接网络，有的设置虚拟网卡，在我这里都行不通。捣鼓下这个方法可以，故分享。NAT的原理是虚拟机和主机在一个局域网内共享一个公有IP地址，桥接网络下虚拟机和主机则是在不同的网络，在两个网络间建立一个逻辑连接。我的这个方法的原理是虚拟机的网络协议都走主机的Clash端口，于是实现了代理上网的功能。
